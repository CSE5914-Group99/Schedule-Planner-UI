<div class="dialog-container">
  <div class="dialog-header">
    <h2>
      @if (isEdit()) {
        Edit Course
      } @else {
        Add Course
      }
    </h2>
    <button class="close-btn" (click)="onCancel()">Ã—</button>
  </div>

  <div class="dialog-body">
    <div class="form-group">
      <label for="courseId">Course ID <span class="required">*</span></label>
      <div style="display: flex; gap: 10px">
        <input
          type="text"
          id="courseId"
          class="form-control"
          placeholder="e.g., CSE2331"
          [value]="courseId()"
          (input)="courseId.set($any($event.target).value)"
          style="flex: 1"
        />
        <button
          class="btn"
          (click)="searchCourses()"
          [disabled]="isSearching()"
          style="background-color: #b00020; color: white"
        >
          {{ isSearching() ? '...' : 'Search' }}
        </button>
      </div>
      <small>Enter the course code (e.g., CSE2331, MATH1151)</small>
      @if (searchError()) {
        <div style="color: red; font-size: 0.9em; margin-top: 5px">{{ searchError() }}</div>
      }
    </div>

    @if (sections().length > 0 && !manualEntry) {
      <div class="form-group">
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Select Section</mat-label>
          <mat-select (selectionChange)="onSectionSelect($event.value)">
            <mat-option [value]="0">-- Any Section (Flexible) --</mat-option>
            @for (section of sections(); track section.session) {
              <mat-option [value]="section.session">
                Sec {{ section.session }} - {{ section.type }} - {{ section.instructor }} ({{
                  section.startTime || 'TBA'
                }}-{{ section.endTime || 'TBA' }}) - {{ section.repeatDays?.join(', ') }} -
                {{ section.status }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }

    <div class="form-group checkbox">
      <mat-checkbox [(ngModel)]="manualEntry"> Manually enter course details </mat-checkbox>
    </div>

    @if (manualEntry) {
      <div class="form-group">
        <label for="instructor">Instructor</label>
        <input
          type="text"
          id="instructor"
          class="form-control"
          placeholder="e.g., Dr. Smith"
          [value]="instructor()"
          (input)="instructor.set($any($event.target).value)"
        />
      </div>

      <div class="form-group">
        <label for="sectionNumber">Section Number</label>
        <input
          type="number"
          id="sectionNumber"
          class="form-control"
          placeholder="e.g., 001"
          [value]="sectionNumber()"
          (input)="sectionNumber.set($any($event.target).valueAsNumber)"
          min="0"
          step="1"
        />
        <small>Optional</small>
      </div>
    }
  </div>

  <div class="dialog-footer">
    <div class="footer-left">
      @if (isEdit()) {
        <button class="btn delete-btn" (click)="onDelete()">Delete Course</button>
      }
    </div>
    <div class="footer-right">
      <button class="btn cancel-btn" (click)="onCancel()">Cancel</button>
      <button class="btn save-btn" (click)="onSave()">
        @if (isEdit()) {
          Update
        } @else {
          Add
        }
        Course
      </button>
    </div>
  </div>
</div>
